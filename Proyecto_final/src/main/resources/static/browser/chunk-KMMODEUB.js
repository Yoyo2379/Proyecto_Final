import{b as it,c as rt}from"./chunk-HIMUIPWK.js";import{a as G}from"./chunk-R7N6EZJW.js";import{a as B,b as $,f as z,g as L,j as Y,k as Z,l as tt,m as et}from"./chunk-KCIO37WG.js";import{E as R,G as c,I as V,J as H,L as J,M as K,N as Q,O as W,Q as X}from"./chunk-5Z4GIFAT.js";import{a as U,b as O,c as N,d as P,e as q,f as w}from"./chunk-QXNWF3HH.js";import{d as F,e as b,h as I,l as y,oa as A,p as T,pa as D,r as j}from"./chunk-OLD2AYRY.js";import{Jb as h,Kb as u,Pa as n,T as S,Y as p,Yb as a,_b as s,cb as M,ib as d,j as C,vb as l,wb as o,xb as e,yb as v}from"./chunk-YGIBANMM.js";import"./chunk-7CGTOI24.js";var nt=[{id:1,name:"Juan Perez",email:"juan@example.com"},{id:2,name:"Maria Lopez",email:"maria@example.com"},{id:3,name:"Carlos Gomez",email:"carlos@example.com"}],g=class i{http=p(y);apiUrl=`${w.apiUrl}/users`;getAll(){return this.http.get(this.apiUrl)}getById(t){return this.http.get(`${this.apiUrl}/${t}`)}getUsers(){return C(nt)}static \u0275fac=function(r){return new(r||i)};static \u0275prov=S({token:i,factory:i.\u0275fac,providedIn:"root"})};function mt(i,t){if(i&1&&(o(0,"mat-error"),a(1),e()),i&2){let r=u();n(),s(" ",r.getErrorMessage("title")," ")}}function lt(i,t){if(i&1&&(o(0,"mat-error"),a(1),e()),i&2){let r=u();n(),s(" ",r.getErrorMessage("description")," ")}}function st(i,t){if(i&1&&(o(0,"mat-error"),a(1),e()),i&2){let r=u();n(),s(" ",r.getErrorMessage("status")," ")}}function pt(i,t){if(i&1&&(o(0,"mat-error"),a(1),e()),i&2){let r=u();n(),s(" ",r.getErrorMessage("priority")," ")}}function dt(i,t){if(i&1&&(o(0,"mat-option",16),a(1),e()),i&2){let r=t.$implicit;l("value",r.id),n(),s(" ",r.name," ")}}function ct(i,t){if(i&1&&(o(0,"mat-error"),a(1),e()),i&2){let r=u();n(),s(" ",r.getErrorMessage("projectId")," ")}}function ut(i,t){if(i&1&&(o(0,"mat-option",16),a(1),e()),i&2){let r=t.$implicit;l("value",r.id),n(),s(" ",r.name," ")}}var ot=class i{fb=p(W);taskService=p(G);projectService=p(et);userService=p(g);router=p(j);route=p(T);taskForm;isEditMode=!1;taskId;loading=!1;projects=[];users=[];ngOnInit(){this.initForm(),this.loadProjects(),this.loadUsers(),this.checkEditMode()}initForm(){this.taskForm=this.fb.group({title:["",[c.required,c.minLength(3)]],description:["",[c.required]],status:["todo",[c.required]],priority:["medium",[c.required]],projectId:["",[c.required]],assigneeId:[null]})}loadProjects(){this.projectService.getAll(0,100).subscribe({next:t=>{this.projects=t.content}})}loadUsers(){this.userService.getAll().subscribe({next:t=>{this.users=t}})}checkEditMode(){let t=this.route.snapshot.paramMap.get("id");t&&(this.isEditMode=!0,this.taskId=+t,this.loadTask())}loadTask(){this.taskId&&(this.loading=!0,this.taskService.getById(this.taskId).subscribe({next:t=>{this.taskForm.patchValue({title:t.title,description:t.description,status:t.status,priority:t.priority,projectId:t.projectId,assigneeId:t.assigneeId}),this.loading=!1},error:()=>{this.loading=!1}}))}onSubmit(){if(this.taskForm.invalid){this.taskForm.markAllAsTouched();return}this.loading=!0;let t=this.taskForm.value;(this.isEditMode&&this.taskId?this.taskService.update(this.taskId,t):this.taskService.create(t)).subscribe({next:()=>{this.router.navigate(["/tasks"])},error:()=>{this.loading=!1}})}onCancel(){this.router.navigate(["/tasks"])}getErrorMessage(t){let r=this.taskForm.get(t);return r?.hasError("required")?"Este campo es requerido":r?.hasError("minlength")?`M\xEDnimo ${r.errors?.minlength.requiredLength} caracteres`:""}static \u0275fac=function(r){return new(r||i)};static \u0275cmp=M({type:i,selectors:[["app-task-form"]],decls:56,vars:12,consts:[[3,"ngSubmit","formGroup"],["appearance","outline",1,"full-width"],["matInput","","formControlName","title","placeholder","T\xEDtulo de la tarea"],[4,"ngIf"],["matInput","","formControlName","description","rows","4","placeholder","Descripci\xF3n de la tarea"],["formControlName","status"],["value","todo"],["value","in_progress"],["value","completed"],["formControlName","priority"],["value","low"],["value","medium"],["value","high"],["formControlName","projectId"],[3,"value",4,"ngFor","ngForOf"],["formControlName","assigneeId"],[3,"value"],[1,"actions"],["mat-button","","type","button",3,"click"],["mat-raised-button","","color","primary","type","submit",3,"disabled"]],template:function(r,m){if(r&1&&(o(0,"mat-card")(1,"mat-card-header")(2,"mat-card-title"),a(3),e()(),o(4,"mat-card-content")(5,"form",0),h("ngSubmit",function(){return m.onSubmit()}),o(6,"mat-form-field",1)(7,"mat-label"),a(8,"T\xEDtulo"),e(),v(9,"input",2),d(10,mt,2,1,"mat-error",3),e(),o(11,"mat-form-field",1)(12,"mat-label"),a(13,"Descripci\xF3n"),e(),v(14,"textarea",4),d(15,lt,2,1,"mat-error",3),e(),o(16,"mat-form-field",1)(17,"mat-label"),a(18,"Estado"),e(),o(19,"mat-select",5)(20,"mat-option",6),a(21,"Por Hacer"),e(),o(22,"mat-option",7),a(23,"En Progreso"),e(),o(24,"mat-option",8),a(25,"Completado"),e()(),d(26,st,2,1,"mat-error",3),e(),o(27,"mat-form-field",1)(28,"mat-label"),a(29,"Prioridad"),e(),o(30,"mat-select",9)(31,"mat-option",10),a(32,"Baja"),e(),o(33,"mat-option",11),a(34,"Media"),e(),o(35,"mat-option",12),a(36,"Alta"),e()(),d(37,pt,2,1,"mat-error",3),e(),o(38,"mat-form-field",1)(39,"mat-label"),a(40,"Proyecto"),e(),o(41,"mat-select",13),d(42,dt,2,2,"mat-option",14),e(),d(43,ct,2,1,"mat-error",3),e(),o(44,"mat-form-field",1)(45,"mat-label"),a(46,"Asignar a"),e(),o(47,"mat-select",15)(48,"mat-option",16),a(49,"Sin asignar"),e(),d(50,ut,2,2,"mat-option",14),e()(),o(51,"div",17)(52,"button",18),h("click",function(){return m.onCancel()}),a(53,"Cancelar"),e(),o(54,"button",19),a(55),e()()()()()),r&2){let f,_,x,E,k;n(3),s("",m.isEditMode?"Editar":"Nueva"," Tarea"),n(2),l("formGroup",m.taskForm),n(5),l("ngIf",(f=m.taskForm.get("title"))==null?null:f.invalid),n(5),l("ngIf",(_=m.taskForm.get("description"))==null?null:_.invalid),n(11),l("ngIf",(x=m.taskForm.get("status"))==null?null:x.invalid),n(11),l("ngIf",(E=m.taskForm.get("priority"))==null?null:E.invalid),n(5),l("ngForOf",m.projects),n(),l("ngIf",(k=m.taskForm.get("projectId"))==null?null:k.invalid),n(5),l("value",null),n(2),l("ngForOf",m.users),n(4),l("disabled",m.loading),n(),s(" ",m.isEditMode?"Actualizar":"Crear"," ")}},dependencies:[I,F,b,X,J,R,V,H,Q,K,q,U,N,P,O,Y,z,B,$,rt,it,D,A,tt,Z,L],styles:["mat-card[_ngcontent-%COMP%]{margin:1rem;max-width:800px}form[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1rem}.full-width[_ngcontent-%COMP%]{width:100%}.actions[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:1rem;margin-top:1rem}"]})};export{ot as TaskFormComponent};
